<!DOCTYPE html>





<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> Third-party APIs</title>
<meta name="viewport" content="width=device-width, initial-scale=1">  
<meta http-equiv="content-language" content="en-us" />

<meta name="og:site_name" value="Mattermost.com">
<meta name="og:title" value="Third-party APIs">

 
  <meta name="description" content="Mattermost Apps framework provides services for using remote (third-party) OAuth2 HTTP APIs, and receiving authenticated webhook notifications from remote systems.">
<meta name="twitter:description" content="Mattermost Apps framework provides services for using remote (third-party) OAuth2 HTTP APIs, and receiving authenticated webhook notifications from remote systems.">
<meta name="og:description" content="Mattermost Apps framework provides services for using remote (third-party) OAuth2 HTTP APIs, and receiving authenticated webhook notifications from remote systems.">



 
<link rel="canonical" href="https://developers.mattermost.com/integrate/apps/using-third-party-api/">


<link rel="shortcut icon" type="image/png" href="https://developers.mattermost.com/img/favicon-32x32.png" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">


<link rel="stylesheet" href="https://developers.mattermost.com/css/bootstrap.min.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/tabs.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/bar.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/styles.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/code.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/note.css">

<script async defer src="https://buttons.github.io/buttons.js"></script>


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53S4TVZ');</script>


    </head>
<body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53S4TVZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    
<header class="with-notification-bar">

    <a href="https://developers.mattermost.com/"><img src="https://developers.mattermost.com/img/logo.svg" alt="Mattermost Logo" width="212px"></a>
    <div class="header__menu-toggle">
        <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links--right">
        <li><a href="https://developers.mattermost.com/">Home</a></li>
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/contribute/getting-started/">Contribute</a></li>
                
            
        
            
            
            
                
                    <li class="active"><a href="https://developers.mattermost.com/integrate/getting-started/">Integrate</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/extend/getting-started/">Extend</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/blog/">Blog</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://docs.mattermost.com/">Admin Docs</a></li>
                
            
        
    </ul>
</header>


<div class='notification-bar sticky-top'>
    <div class="notification-bar__content">
        <a class="notification-bar__close">
            <span aria-hidden="true">Ã—</span>
        </a>
        <a href="https://mattermost.com/careers">
            We&#39;re hiring!
        </a>
    </div>
</div>




    <div id="wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 sidebar">
    <div class="sidebar__menu-toggle">
        Third-party APIs
        <i class="fa fa-bars pull-right"></i>
    </div>
    <div class="row sidebar__links">
        
            
        
            
        
            
        
            
        
            
            
                
                

                
                

                
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="https://developers.mattermost.com/integrate/getting-started/"> Getting Started</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/getting-started/how-should-i-integrate/"> How Should I Integrate?</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/incoming-webhooks/"> Incoming Webhooks</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/outgoing-webhooks/"> Outgoing Webhooks</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/slash-commands/"> Slash Commands</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/rest-api/"> API Reference</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/examples/"> Examples</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                
                    
                

                
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="https://developers.mattermost.com/integrate/apps/"> Apps (Developers Preview)</a>
                    
                </span>

                <ul class="sub-menu" style="display: block">
                    
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/quick-start-js/"> Quick start guide (JS)</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/quick-start-go/"> Quick start guide (Go)</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/manifest/"> Manifest</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/call/"> Call</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/bindings/"> Bindings</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/interactivity/"> Interactivity</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                            
                                <span class="item ">
                                
                                    <a href="https://developers.mattermost.com/integrate/apps/interactivity/example-post-menu/"> Post Menu Example</a>
                                
                                </span>
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/using-mattermost-api/"> Apps APIs</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        
                            
                        

                        
                        
                            
                        

                        <span class="item active">
                            <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a class="active" href="#"> Third-party APIs</a>
                            
                        </span>

                        <ul class="sub-menu" style="display: block">
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/lifecycle/"> App Lifecycle</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/deployment/"> Deployment</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                </ul>
            
            
        
    </div>
</div>

                <div class="col-lg-9 doc-content">
                    
<a href="https://github.com/mattermost/mattermost-developer-documentation/edit/master/site/content/integrate/apps/using-third-party-api/_index.md" class="float-right edit-github">
    Edit on GitHub
</a>


                    <h1 class="mt-0 doc-title">
                        
                            Using third-party APIs for Apps
                        
                    </h1>
                    <p>There are two examples here to illustrate the <a href="#hello-oauth2">OAuth2</a> and <a href="#hello-webhooks">webhook</a> support.</p>
<h2 id="hello-oauth2">Hello OAuth2!&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#hello-oauth2"></i></a> </h2>
<p>This is an example of an HTTP app (<a href="https://github.com/mattermost/mattermost-plugin-apps/tree/master/examples/go/hello-oauth2">source</a>), written in Go and runnable on http://localhost:8080.</p>
<ul>
<li>It contains a <code>manifest.json</code>, declares itself an HTTP application, requests permissions, and binds itself to locations in the Mattermost user interface.</li>
<li>In its <code>bindings</code> function it declares three commands: <code>configure</code>, <code>connect</code>, and <code>send</code>.</li>
<li>Its <code>send</code> function mentions the user by their Google name, and lists their Google Calendars.</li>
</ul>
<p>To install &ldquo;Hello, OAuth2&rdquo; on a locally-running instance of Mattermost follow these steps (go 1.16 is required):</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git clone https://github.com/mattermost/mattermost-plugin-apps.git
<span style="color:#366">cd</span> mattermost-plugin-apps/examples/go/hello-oauth2
go run . 
</code></pre></div><p>In the Mattermost Desktop client run:</p>
<pre><code>/apps debug-add-manifest --url http://localhost:8080/manifest.json
/apps install hello-oauth2
</code></pre><p>You need to configure your <a href="https://console.cloud.google.com/apis/credentials">Google API Credentials</a> for the app. Use <code>$MATTERMOST_SITE_URL$/com.mattermost.apps/apps/hello-oauth2/oauth2/remote/complete</code> for the <code>Authorized redirect URIs</code> field. After configuring the credentials, in the Mattermost Desktop client run:</p>
<pre><code>/hello-oauth2 configure --client-id $CLIENT_ID --client-secret $CLIENT_SECRET
</code></pre><p>Now, you can connect your account to Google with <code>/hello-oauth2 connect</code> command, and then try <code>/hello-oauth2 send</code>.</p>
<h3 id="manifest">Manifest&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#manifest"></i></a> </h3>
<p>Hello OAuth2! is an HTTP app, it requests the <em>permissions</em> to act as a System Admin to change the app&rsquo;s OAuth2 config, as a user to connect and send. It binds itself to <code>/</code> commands.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#309;font-weight:bold">&#34;app_id&#34;</span>: <span style="color:#c30">&#34;hello-oauth2&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;version&#34;</span>:<span style="color:#c30">&#34;demo&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;display_name&#34;</span>: <span style="color:#c30">&#34;Hello, OAuth2!&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;app_type&#34;</span>: <span style="color:#c30">&#34;http&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;root_url&#34;</span>: <span style="color:#c30">&#34;http://localhost:8080&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;homepage_url&#34;</span>: <span style="color:#c30">&#34;https://github.com/mattermost/mattermost-plugin-apps/examples/go/hello-oauth2&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;requested_permissions&#34;</span>: [
		<span style="color:#c30">&#34;act_as_admin&#34;</span>,
		<span style="color:#c30">&#34;act_as_user&#34;</span>,
		<span style="color:#c30">&#34;remote_oauth2&#34;</span>
	],
	<span style="color:#309;font-weight:bold">&#34;requested_locations&#34;</span>: [
		<span style="color:#c30">&#34;/command&#34;</span>
	]
}
</code></pre></div><h3 id="bindings-and-locations">Bindings and locations&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#bindings-and-locations"></i></a> </h3>
<p>The Hello OAuth2 app creates three commands: <code>/helloworld configure | connect | send</code>.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#309;font-weight:bold">&#34;type&#34;</span>: <span style="color:#c30">&#34;ok&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;data&#34;</span>: [
		{
			<span style="color:#309;font-weight:bold">&#34;location&#34;</span>: <span style="color:#c30">&#34;/command&#34;</span>,
			<span style="color:#309;font-weight:bold">&#34;bindings&#34;</span>: [
				{
					<span style="color:#309;font-weight:bold">&#34;icon&#34;</span>: <span style="color:#c30">&#34;http://localhost:8080/static/icon.png&#34;</span>,
					<span style="color:#309;font-weight:bold">&#34;label&#34;</span>: <span style="color:#c30">&#34;helloworld&#34;</span>,
					<span style="color:#309;font-weight:bold">&#34;description&#34;</span>: <span style="color:#c30">&#34;Hello remote (3rd party) OAuth2 App&#34;</span>,
					<span style="color:#309;font-weight:bold">&#34;hint&#34;</span>: <span style="color:#c30">&#34;[configure | connect | send]&#34;</span>,
					<span style="color:#309;font-weight:bold">&#34;bindings&#34;</span>: [
						{
							<span style="color:#309;font-weight:bold">&#34;location&#34;</span>: <span style="color:#c30">&#34;configure&#34;</span>,
							<span style="color:#309;font-weight:bold">&#34;label&#34;</span>: <span style="color:#c30">&#34;configure&#34;</span>,
							<span style="color:#309;font-weight:bold">&#34;call&#34;</span>: {
								<span style="color:#309;font-weight:bold">&#34;path&#34;</span>: <span style="color:#c30">&#34;/configure&#34;</span>
							}
						},
						{
							<span style="color:#309;font-weight:bold">&#34;location&#34;</span>: <span style="color:#c30">&#34;connect&#34;</span>,
							<span style="color:#309;font-weight:bold">&#34;label&#34;</span>: <span style="color:#c30">&#34;connect&#34;</span>,
							<span style="color:#309;font-weight:bold">&#34;call&#34;</span>: {
								<span style="color:#309;font-weight:bold">&#34;path&#34;</span>: <span style="color:#c30">&#34;/connect&#34;</span>
							}
						},
						{
							<span style="color:#309;font-weight:bold">&#34;location&#34;</span>: <span style="color:#c30">&#34;send&#34;</span>,
							<span style="color:#309;font-weight:bold">&#34;label&#34;</span>: <span style="color:#c30">&#34;send&#34;</span>,
							<span style="color:#309;font-weight:bold">&#34;call&#34;</span>: {
								<span style="color:#309;font-weight:bold">&#34;path&#34;</span>: <span style="color:#c30">&#34;/send&#34;</span>
							}
						}
					]
				}
			]
		}
	]
}
</code></pre></div><h3 id="configuring-oauth2">Configuring OAuth2&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#configuring-oauth2"></i></a> </h3>
<p><code>/hello-oauth2 configure</code> sets up the Google OAuth2 credentials. It accepts two string flags, <code>--client-id</code> and <code>--client-secret</code>. Submit will require an Admin token to affect the changes.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#309;font-weight:bold">&#34;type&#34;</span>: <span style="color:#c30">&#34;form&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;form&#34;</span>: {
		<span style="color:#309;font-weight:bold">&#34;title&#34;</span>: <span style="color:#c30">&#34;Configures Google OAuth2 App credentials&#34;</span>,
		<span style="color:#309;font-weight:bold">&#34;icon&#34;</span>: <span style="color:#c30">&#34;http://localhost:8080/static/icon.png&#34;</span>,
		<span style="color:#309;font-weight:bold">&#34;fields&#34;</span>: [
			{
				<span style="color:#309;font-weight:bold">&#34;type&#34;</span>: <span style="color:#c30">&#34;text&#34;</span>,
				<span style="color:#309;font-weight:bold">&#34;name&#34;</span>: <span style="color:#c30">&#34;client_id&#34;</span>,
				<span style="color:#309;font-weight:bold">&#34;label&#34;</span>: <span style="color:#c30">&#34;client-id&#34;</span>,
				<span style="color:#309;font-weight:bold">&#34;is_required&#34;</span>: <span style="color:#069;font-weight:bold">true</span>
			},
			{
				<span style="color:#309;font-weight:bold">&#34;type&#34;</span>: <span style="color:#c30">&#34;text&#34;</span>,
				<span style="color:#309;font-weight:bold">&#34;name&#34;</span>: <span style="color:#c30">&#34;client_secret&#34;</span>,
				<span style="color:#309;font-weight:bold">&#34;label&#34;</span>: <span style="color:#c30">&#34;client-secret&#34;</span>,
				<span style="color:#309;font-weight:bold">&#34;is_required&#34;</span>: <span style="color:#069;font-weight:bold">true</span>
			}
		],
		<span style="color:#309;font-weight:bold">&#34;call&#34;</span>: {
			<span style="color:#309;font-weight:bold">&#34;path&#34;</span>: <span style="color:#c30">&#34;/configure&#34;</span>,
			<span style="color:#309;font-weight:bold">&#34;expand&#34;</span>: {
				<span style="color:#309;font-weight:bold">&#34;admin_access_token&#34;</span>: <span style="color:#c30">&#34;all&#34;</span>
			}
		}
	}
}
</code></pre></div><p>The command handler uses an admin-only <code>StoreOAuth2App</code> API to store the credentials, and make them available to future calls with <code>expand.oauth2_app=&quot;all&quot;</code>.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">configure</span>(w http.ResponseWriter, req <span style="color:#555">*</span>http.Request) {
	creq <span style="color:#555">:=</span> apps.CallRequest{}
	json.<span style="color:#c0f">NewDecoder</span>(req.Body).<span style="color:#c0f">Decode</span>(<span style="color:#555">&amp;</span>creq)
	clientID, _ <span style="color:#555">:=</span> creq.Values[<span style="color:#c30">&#34;client_id&#34;</span>].(<span style="color:#078;font-weight:bold">string</span>)
	clientSecret, _ <span style="color:#555">:=</span> creq.Values[<span style="color:#c30">&#34;client_secret&#34;</span>].(<span style="color:#078;font-weight:bold">string</span>)

	asAdmin <span style="color:#555">:=</span> mmclient.<span style="color:#c0f">AsAdmin</span>(creq.Context)
	asAdmin.<span style="color:#c0f">StoreOAuth2App</span>(creq.Context.AppID, clientID, clientSecret)

	json.<span style="color:#c0f">NewEncoder</span>(w).<span style="color:#c0f">Encode</span>(apps.CallResponse{
		Markdown: <span style="color:#c30">&#34;updated OAuth client credentials&#34;</span>,
	})
}
</code></pre></div><h3 id="connecting-as-a-user">Connecting as a user&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#connecting-as-a-user"></i></a> </h3>
<h4 id="connect-command"><code>connect</code> command&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#connect-command"></i></a> </h4>
<p><code>/hello-oauth2 connect</code> formats and displays a link that starts the OAuth2 flow with the remote system. The URL (provided to the app in the <code>Context</code>) is handled by the apps framework. It will:</p>
<ul>
<li>Create a one-time secret (&ldquo;state&rdquo;).</li>
<li>Invoke <code>oauth2Connect</code> to generate the remote URL that starts the flow.</li>
<li>Redirect the user&rsquo;s browser there.</li>
</ul>
<p>Note <code>expand.oauth2_app=&quot;all&quot;</code> in the form definition, it includes the app&rsquo;s OAuth2 Mattermost-hosted callback URL in the request context. This command should soon be provided by the framework, see <a href="https://mattermost.atlassian.net/browse/MM-34561">MM-34561</a>.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#309;font-weight:bold">&#34;type&#34;</span>: <span style="color:#c30">&#34;form&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;form&#34;</span>: {
		<span style="color:#309;font-weight:bold">&#34;title&#34;</span>: <span style="color:#c30">&#34;Connect to Google&#34;</span>,
		<span style="color:#309;font-weight:bold">&#34;icon&#34;</span>: <span style="color:#c30">&#34;http://localhost:8080/static/icon.png&#34;</span>,
		<span style="color:#309;font-weight:bold">&#34;call&#34;</span>: {
			<span style="color:#309;font-weight:bold">&#34;path&#34;</span>: <span style="color:#c30">&#34;/connect&#34;</span>,
			<span style="color:#309;font-weight:bold">&#34;expand&#34;</span>: {
				<span style="color:#309;font-weight:bold">&#34;oauth2_app&#34;</span>: <span style="color:#c30">&#34;all&#34;</span>
			}
		}
	}
}
</code></pre></div><div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">connect</span>(w http.ResponseWriter, req <span style="color:#555">*</span>http.Request) {
	creq <span style="color:#555">:=</span> apps.CallRequest{}
	json.<span style="color:#c0f">NewDecoder</span>(req.Body).<span style="color:#c0f">Decode</span>(<span style="color:#555">&amp;</span>creq)

	json.<span style="color:#c0f">NewEncoder</span>(w).<span style="color:#c0f">Encode</span>(apps.CallResponse{
		Markdown: md.<span style="color:#c0f">Markdownf</span>(<span style="color:#c30">&#34;[Connect](%s) to Google.&#34;</span>, creq.Context.OAuth2.ConnectURL),
	})
}
</code></pre></div><h4 id="oauth2-call-handlers">OAuth2 call handlers&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#oauth2-call-handlers"></i></a> </h4>
<p>To handle the OAuth2 <code>connect</code> flow, the app provides two calls: <code>/oauth2/connect</code> that returns the URL to redirect the user to, and <code>/oauth2/complete</code> which gets invoked once the flow is finished, and the <code>state</code> parameter is verified.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">	<span style="color:#09f;font-style:italic">// Handle an OAuth2 connect URL request.
</span><span style="color:#09f;font-style:italic"></span>	http.<span style="color:#c0f">HandleFunc</span>(<span style="color:#c30">&#34;/oauth2/connect&#34;</span>, oauth2Connect)

	<span style="color:#09f;font-style:italic">// Handle a successful OAuth2 connection.
</span><span style="color:#09f;font-style:italic"></span>	http.<span style="color:#c0f">HandleFunc</span>(<span style="color:#c30">&#34;/oauth2/complete&#34;</span>, oauth2Complete)
</code></pre></div><p><code>oauth2Connect</code> extracts the necessary data from the request&rsquo;s context and values (&ldquo;state&rdquo;), and composes a Google OAuth2 initial URL.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">oauth2Connect</span>(w http.ResponseWriter, req <span style="color:#555">*</span>http.Request) {
	creq <span style="color:#555">:=</span> apps.CallRequest{}
	json.<span style="color:#c0f">NewDecoder</span>(req.Body).<span style="color:#c0f">Decode</span>(<span style="color:#555">&amp;</span>creq)
	state, _ <span style="color:#555">:=</span> creq.Values[<span style="color:#c30">&#34;state&#34;</span>].(<span style="color:#078;font-weight:bold">string</span>)

	url <span style="color:#555">:=</span> <span style="color:#c0f">oauth2Config</span>(<span style="color:#555">&amp;</span>creq).<span style="color:#c0f">AuthCodeURL</span>(state, oauth2.AccessTypeOffline, oauth2.ApprovalForce)
	json.<span style="color:#c0f">NewEncoder</span>(w).<span style="color:#c0f">Encode</span>(apps.CallResponse{
		Type: apps.CallResponseTypeOK,
		Data: url,
	})
}
</code></pre></div><p><code>oauth2Complete</code> is called upon the successful completion (including the validation of the &ldquo;state&rdquo;). It is responsible for creating an OAuth2 token, and storing it in the Mattermost OAuth2 user store.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">oauth2Complete</span>(w http.ResponseWriter, req <span style="color:#555">*</span>http.Request) {
	creq <span style="color:#555">:=</span> apps.CallRequest{}
	json.<span style="color:#c0f">NewDecoder</span>(req.Body).<span style="color:#c0f">Decode</span>(<span style="color:#555">&amp;</span>creq)
	code, _ <span style="color:#555">:=</span> creq.Values[<span style="color:#c30">&#34;code&#34;</span>].(<span style="color:#078;font-weight:bold">string</span>)

	token, _ <span style="color:#555">:=</span> <span style="color:#c0f">oauth2Config</span>(<span style="color:#555">&amp;</span>creq).<span style="color:#c0f">Exchange</span>(context.<span style="color:#c0f">Background</span>(), code)

	asActingUser <span style="color:#555">:=</span> mmclient.<span style="color:#c0f">AsActingUser</span>(creq.Context)
	asActingUser.<span style="color:#c0f">StoreOAuth2User</span>(creq.Context.AppID, token)

	json.<span style="color:#c0f">NewEncoder</span>(w).<span style="color:#c0f">Encode</span>(apps.CallResponse{})
}
</code></pre></div><h4 id="obtaining-an-oauth2-config-for-a-call">Obtaining an OAuth2 &ldquo;Config&rdquo; for a call&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#obtaining-an-oauth2-config-for-a-call"></i></a> </h4>
<p>The app is responsible for composing its own remote OAuth2 config, using the remote system-specific settings. The <code>ClientID</code> and <code>ClientSecret</code> are stored in Mattermost OAuth2App record, and are included in the request context if specified with <code>expand.oauth2_app=&quot;all&quot;</code>.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">import</span> (
	<span style="color:#c30">&#34;golang.org/x/oauth2&#34;</span>
	<span style="color:#c30">&#34;golang.org/x/oauth2/google&#34;</span>
)

<span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">oauth2Config</span>(creq <span style="color:#555">*</span>apps.CallRequest) <span style="color:#555">*</span>oauth2.Config {
	<span style="color:#069;font-weight:bold">return</span> <span style="color:#555">&amp;</span>oauth2.Config{
		ClientID:     creq.Context.OAuth2.ClientID,
		ClientSecret: creq.Context.OAuth2.ClientSecret,
		Endpoint:     google.Endpoint,
		RedirectURL:  creq.Context.OAuth2.CompleteURL,
		Scopes: []<span style="color:#078;font-weight:bold">string</span>{
			<span style="color:#c30">&#34;https://www.googleapis.com/auth/calendar&#34;</span>,
			<span style="color:#c30">&#34;https://www.googleapis.com/auth/userinfo.profile&#34;</span>,
			<span style="color:#c30">&#34;https://www.googleapis.com/auth/userinfo.email&#34;</span>,
		},
	}
}
</code></pre></div><h3 id="send-command"><code>send</code> command&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#send-command"></i></a> </h3>
<p><code>/hello-oauth2 send</code> sends the user a message that includes the Google user name on the account, and lists the Google Calendars. The form requests that submit calls expand <code>oauth2_user</code> which is where the app stored the OAuth2 token upon a successful connect.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#309;font-weight:bold">&#34;type&#34;</span>: <span style="color:#c30">&#34;form&#34;</span>,
	<span style="color:#309;font-weight:bold">&#34;form&#34;</span>: {
		<span style="color:#309;font-weight:bold">&#34;title&#34;</span>: <span style="color:#c30">&#34;Send a Google-connected &#39;hello, world!&#39; message&#34;</span>,
		<span style="color:#309;font-weight:bold">&#34;icon&#34;</span>: <span style="color:#c30">&#34;http://localhost:8080/static/icon.png&#34;</span>,
		<span style="color:#309;font-weight:bold">&#34;call&#34;</span>: {
			<span style="color:#309;font-weight:bold">&#34;path&#34;</span>: <span style="color:#c30">&#34;/send&#34;</span>,
			<span style="color:#309;font-weight:bold">&#34;expand&#34;</span>: {
				<span style="color:#309;font-weight:bold">&#34;oauth2_user&#34;</span>: <span style="color:#c30">&#34;all&#34;</span>
			}
		}
	}
}
</code></pre></div><div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> <span style="color:#c0f">send</span>(w http.ResponseWriter, req <span style="color:#555">*</span>http.Request) {
	creq <span style="color:#555">:=</span> apps.CallRequest{}
	json.<span style="color:#c0f">NewDecoder</span>(req.Body).<span style="color:#c0f">Decode</span>(<span style="color:#555">&amp;</span>creq)

	oauthConfig <span style="color:#555">:=</span> <span style="color:#c0f">oauth2Config</span>(<span style="color:#555">&amp;</span>creq)
	token <span style="color:#555">:=</span> oauth2.Token{}
	<span style="color:#c0f">remarshal</span>(<span style="color:#555">&amp;</span>token, creq.Context.OAuth2.User) <span style="color:#09f;font-style:italic">// go JSON is quirky!
</span><span style="color:#09f;font-style:italic"></span>	ctx <span style="color:#555">:=</span> context.<span style="color:#c0f">Background</span>()
	tokenSource <span style="color:#555">:=</span> oauthConfig.<span style="color:#c0f">TokenSource</span>(ctx, <span style="color:#555">&amp;</span>token)
	oauth2Service, _ <span style="color:#555">:=</span> oauth2api.<span style="color:#c0f">NewService</span>(ctx, option.<span style="color:#c0f">WithTokenSource</span>(tokenSource))
	calService, _ <span style="color:#555">:=</span> calendar.<span style="color:#c0f">NewService</span>(ctx, option.<span style="color:#c0f">WithTokenSource</span>(tokenSource))
	uiService <span style="color:#555">:=</span> oauth2api.<span style="color:#c0f">NewUserinfoService</span>(oauth2Service)

	ui, _ <span style="color:#555">:=</span> uiService.V2.Me.<span style="color:#c0f">Get</span>().<span style="color:#c0f">Do</span>()
	message <span style="color:#555">:=</span> fmt.<span style="color:#c0f">Sprintf</span>(<span style="color:#c30">&#34;Hello from Google, [%s](mailto:%s)!&#34;</span>, ui.Name, ui.Email)
	cl, _ <span style="color:#555">:=</span> calService.CalendarList.<span style="color:#c0f">List</span>().<span style="color:#c0f">Do</span>()
	<span style="color:#069;font-weight:bold">if</span> cl <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> <span style="color:#555">&amp;&amp;</span> <span style="color:#366">len</span>(cl.Items) &gt; <span style="color:#f60">0</span> {
		message <span style="color:#555">+=</span> <span style="color:#c30">&#34; You have the following calendars:\n&#34;</span>
		<span style="color:#069;font-weight:bold">for</span> _, item <span style="color:#555">:=</span> <span style="color:#069;font-weight:bold">range</span> cl.Items {
			message <span style="color:#555">+=</span> <span style="color:#c30">&#34;- &#34;</span> <span style="color:#555">+</span> item.Summary <span style="color:#555">+</span> <span style="color:#c30">&#34;\n&#34;</span>
		}
	} <span style="color:#069;font-weight:bold">else</span> {
		message <span style="color:#555">+=</span> <span style="color:#c30">&#34; You have no calendars.\n&#34;</span>
	}

	json.<span style="color:#c0f">NewEncoder</span>(w).<span style="color:#c0f">Encode</span>(apps.CallResponse{
		Markdown: md.<span style="color:#c0f">MD</span>(message),
	})
}
</code></pre></div><h2 id="hello-webhooks">Hello Webhooks!&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#hello-webhooks"></i></a> </h2>
<p>This is an example of an HTTP app (<a href="https://github.com/mattermost/mattermost-plugin-apps/tree/master/examples/go/hello-webhooks">source</a>), written in Go and runnable on http://localhost:8080.</p>


                </div>
            </div>
        </div>
    </div>
    <footer class="text-center">
    <div class="container-fluid">
        <div class="footer__copyright">Â© Mattermost, Inc. All Rights Reserved.</div>
        <div class="footer__icons">
            <a href="https://www.facebook.com/Mattermost-2300985916642531/" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/mattermost" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-twitter"></i></a>
            <a href="https://www.youtube.com/channel/UCNR05H72hi692y01bWaFXNA" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-youtube"></i></a>
        </div>
    </div>
</footer>


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script src="https://developers.mattermost.com/js/tabs.js"></script>
<script src="https://developers.mattermost.com/js/main.js"></script>

</body>
</html>
