<!DOCTYPE html>





<html>

<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> Subpath Support</title>
<meta name="viewport" content="width=device-width, initial-scale=1">  
<meta http-equiv="content-language" content="en-us" />

<meta name="og:site_name" value="Mattermost.com">
<meta name="og:title" value="Subpath Support">

 
  <meta name="description" content="Mattermost 5.1 includes support for serving Mattermost from subpaths. Learn how to configure subpaths in production.">
<meta name="twitter:description" content="Mattermost 5.1 includes support for serving Mattermost from subpaths. Learn how to configure subpaths in production.">
<meta name="og:description" content="Mattermost 5.1 includes support for serving Mattermost from subpaths. Learn how to configure subpaths in production.">



 
<link rel="canonical" href="https://developers.mattermost.com/blog/subpath/">


<link rel="shortcut icon" type="image/png" href="https://developers.mattermost.com/img/favicon-32x32.png" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">


<link rel="stylesheet" href="https://developers.mattermost.com/css/bootstrap.min.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/tabs.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/bar.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/styles.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/code.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/note.css">

<script async defer src="https://buttons.github.io/buttons.js"></script>


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53S4TVZ');</script>


</head>

<body class="blog-single">
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53S4TVZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    
<header class="with-notification-bar">

    <a href="https://developers.mattermost.com/"><img src="https://developers.mattermost.com/img/logo.svg" alt="Mattermost Logo" width="212px"></a>
    <div class="header__menu-toggle">
        <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links--right">
        <li><a href="https://developers.mattermost.com/">Home</a></li>
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/contribute/getting-started/">Contribute</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/integrate/getting-started/">Integrate</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/extend/getting-started/">Extend</a></li>
                
            
        
            
            
            
                
                    <li class="active"><a href="https://developers.mattermost.com/blog/">Blog</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://docs.mattermost.com/">Admin Docs</a></li>
                
            
        
    </ul>
</header>


<div class='notification-bar sticky-top'>
    <div class="notification-bar__content">
        <a class="notification-bar__close">
            <span aria-hidden="true">Ã—</span>
        </a>
        <a href="https://mattermost.com/careers">
            We&#39;re hiring!
        </a>
    </div>
</div>




    <div class="container">
        <div class="row">
            <div class="col-md-9 doc-content">
                <div class="well well-sm">
                    <div class="blog-item__header">
                        <div class="blog-item__title">
                            <h1>
                            
                                Mattermost and Subpath Support
                            
                            </h1>
                            <small>Mattermost 5.1 includes support for serving Mattermost from subpaths. Learn how to configure subpaths in production.</small>
                            
                        </div>
                        <div class="blog-item__info">
                            June 25, 2018
                            <small class="blog-item__count">393 words</small>
                        </div>
                    </div>
                    <hr>
                    <p>Mattermost 5.1 will include support for <a href="https://mattermost.atlassian.net/browse/MM-10366">serving Mattermost from subpaths</a>. This allows Mattermost to be exposed at something like <a href="https://example.com/company/mattermost,">https://example.com/company/mattermost,</a> with your proxy server exposing different services at other subpaths. Subpath support is configured via the <a href="https://docs.mattermost.com/administration/config-settings.html?highlight=siteurl#site-url">Site URL</a>.</p>
<h4 id="using-subpaths-in-production">Using subpaths in production&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#using-subpaths-in-production"></i></a> </h4>
<p>In production, after configuration and restart, the application server expects all HTTP requests to be anchored to the configured subpath. This includes static assets, API calls, and WebSockets. For convenience, the application server redirects any unexpected requests back into this subpath, e.g. forwarding <a href="http://example.com/login">http://example.com/login</a> to <a href="http://example.com/company/mattermost/login">http://example.com/company/mattermost/login</a>.</p>
<p>The pre-built static assets shipped with Mattermost assume being hosted at <code>/static/</code>. In production, when the <code>SiteURL</code> is configured with a subpath such as <a href="https://example.com/company/mattermost,">https://example.com/company/mattermost,</a> the application server rewrites any affected assets on startup to point at <code>/company/mattermost/static</code> instead. This rewriting can be done manually with the <code>mattermost config subpath</code> command:</p>
<pre><code>mattermost config subpath --path /company/mattermost
</code></pre><p>Rewriting the static assets manually may be necessary when deploying to a CDN.</p>
<h4 id="using-subpaths-in-development">Using subpaths in development&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#using-subpaths-in-development"></i></a> </h4>
<p>In development, with webpack running, the static assets are rewritten whenever a source file changes. While the server is still configured via the <code>SiteURL</code>, webpack requires this to be set via an environment variable:</p>
<pre><code>cd mattermost-webapp/
make stop
export MM_SERVICESETTINGS_SITEURL='http://localhost:8065/company/mattermost'
make run
</code></pre><p>To resume testing at the root, either define a <code>SiteURL</code> with no subpath or unset the environment variable:</p>
<pre><code>unset MM_SERVICESETTINGS_SITEURL
make restart
</code></pre><p>This environment variable is also honoured by the server as an override to config.json as described in <a href="https://docs.mattermost.com/administration/config-settings.html#configuration-settings">documentation</a>. Therefore, you can include this export in your shell&rsquo;s initialization script to apply to both the server and the webapp simultaneously.</p>
<h4 id="how-do-subpaths-work">How do subpaths work?&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#how-do-subpaths-work"></i></a> </h4>
<p>Under the covers, in development, our <a href="https://github.com/mattermost/mattermost-webapp/blob/daefd1c76844612f3aaccfb5e42f12000e59cbfd/webpack.config.js#L136">webpack.config.js</a> parses the <code>MM_SERVICESETTINGS_SITEURL</code> environment variable to extract the subpath. This is first used by <a href="https://webpack.js.org/plugins/html-webpack-plugin/">HtmlWebpackPlugin</a> to anchor the assets loaded by <a href="https://github.com/mattermost/mattermost-webapp/blob/master/root.html">root.html</a>. It is then exported into the node environment as <code>process.env.PUBLIC_PATH</code> and used by <a href="https://github.com/mattermost/mattermost-webapp/blob/master/entry.js">entry.js</a> to define <a href="https://webpack.js.org/guides/public-path/"><code>__webpack_public_path__</code></a>, affecting all modules loaded dynamically after the web application starts.</p>
<p>In production, with a non-root subpath, the application server <a href="https://github.com/mattermost/mattermost-server/blob/dd35ad43caab407cc70ef3b153b3f94d57242ed9/utils/subpath.go#L26">rewrites</a> root.html to export <code>window.publicPath</code>. This is checked by entry.js to similarly define <code>__webpack_public_path__</code>. Since <code>HtmlWebpackPlugin</code> is only run during development, the server also rewrites parts of <code>root.html</code> and various CSS files to reflect the correct subpath. To make the rewriting robust against multiple subpath changes, the application server <a href="https://github.com/mattermost/mattermost-server/blob/dd35ad43caab407cc70ef3b153b3f94d57242ed9/utils/subpath.go#L50">uses</a> any existing definition of <code>window.publicPath</code> to match the appropriate strings.</p>


                    <hr>
                    
                    Written by
                    
                    Jesse Hallam
-
<a href="https://community.mattermost.com/core/messages/@jesse.hallam" target="_blank">
    @jesse.hallam
</a>
on
<a href="https://community.mattermost.com/signup_user_complete" target="_blank">
    community.mattermost.com
</a>
and
<a href="https://github.com/lieut-data" target="_blank">
    @lieut-data
</a>
on GitHub

                    
                    
                    <br />
                    <br />
                    Join us on <a href="https://community.mattermost.com/signup_user_complete"
                        target="_blank">community.mattermost.com</a>!
                </div>
            </div>

            
            <div class="col-md-3 doc-content tags-sidebar">
                <div class="well well-sm">

                    


                    <h6>Other Posts</h6>
                    <ul class="list-unstyled">
                        
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/streamlining-developer-access-to-prometheus-and-grafana/">Streamlining Developer Access to Prometheus and Grafana</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/common-i18n-mistakes/">Avoiding Common Internationalization Mistakes</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/mysql-index-merge/">Tuning MySQL and the Ghost of Index Merge Intersection</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/docker-content-trust-in-gitlab-with-delegation/">Docker Content Trust in GitLab&#39;s .gitlab-ci.yml with Delegation</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/improving-performance-through-load-testing/">Improving performance (and more) through load testing</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/automated-ui-testing-with-cypress/">Automated UI Testing With Cypress</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/pritunl/">From OpenVPN to Pritunl VPN: The transition</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/open-tracing/">OpenTracing for Go Projects</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/hands-on-iouring-go/">Getting Hands-on with io_uring using Go</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/advanced-git-tbilisi-free-university/">Advanced Git with the Free University of Tbilisi</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/all-about-emojis/">All About Emojis</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/maintaining-consistency-in-codebases-with-go-vet/">Maintaining Consistency in Codebases with Go vet</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/instrumenting-go-code-via-ast-2/">Instrumenting Go code via AST, Part 2</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/layered-store-and-struct-embedding/">Layered Store and Struct Embedding in Go</a></li>
                        
                        
                    </ul>
                    <h6>Categories</h6>
                    <ul class="list-unstyled">
                        
                    <li>- <a href="https://developers.mattermost.com/categories/announcement">announcement</a></li>
                           
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <footer class="text-center">
    <div class="container-fluid">
        <div class="footer__copyright">Â© Mattermost, Inc. All Rights Reserved.</div>
        <div class="footer__icons">
            <a href="https://www.facebook.com/Mattermost-2300985916642531/" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/mattermost" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-twitter"></i></a>
            <a href="https://www.youtube.com/channel/UCNR05H72hi692y01bWaFXNA" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-youtube"></i></a>
        </div>
    </div>
</footer>


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script src="https://developers.mattermost.com/js/tabs.js"></script>
<script src="https://developers.mattermost.com/js/main.js"></script>

</body>

</html>
